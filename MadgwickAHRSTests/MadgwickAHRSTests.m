//
//  MadgwickAHRSTests.m
//  MadgwickAHRSTests
//
//  Created by Brian Lambert on 6/10/16.
//  Copyright Â© 2016 Softwarenerd. All rights reserved.
//

#import <XCTest/XCTest.h>
#import "MadgwickSensorFusion.h"

// Normalizes.
float NormalizeAngle(float angle)
{
    return fmodf(angle + 360.0f, 360.0f);
}

// Converts radians to degrees.
static inline float RadiansToDegrees(float radians)
{
    return radians * 180.0f / M_PI;
}

// Calculates Euler angles from quaternion.
void CalculateEulerAnglesFromQuaternion(float q0, float q1, float q2, float q3, float * roll, float * pitch, float * yaw)
{
    const float w2 = q0 * q0;
    const float x2 = q1 * q1;
    const float y2 = q2 * q2;
    const float z2 = q3 * q3;
    const float unitLength = w2 + x2 + y2 + z2;     // Normalised == 1, otherwise correction divisor.
    const float abcd = q0 * q1 + q2 * q3;
    const float eps = 1e-7;                         // TODO: pick from your math lib instead of hardcoding.
    if (abcd > (0.5-eps) * unitLength)
    {
        *roll = 0;
        *pitch = M_PI;
        *yaw = 2.0f * atan2(q2, q0);
    }
    else if (abcd < (-0.5 + eps) * unitLength)
    {
        *roll  = 0;
        *pitch = -M_PI;
        *yaw   = -2.0f * atan2(q2, q0);
    }
    else
    {
        const float adbc = q0 * q3 - q1 * q2;
        const float acbd = q0 * q2 - q1 * q3;
        *roll  = atan2(2.0f * acbd, 1.0f - 2.0f * (y2 + x2));
        *pitch = asin(2.0f * abcd / unitLength);
        *yaw   = atan2(2.0f * adbc, 1.0f - 2.0f * (z2 + x2));
    }
}

// MadgwickAHRSTests interface.
@interface MadgwickAHRSTests : XCTestCase
@end

// MadgwickAHRSTests implementation.
@implementation MadgwickAHRSTests

// Setup.
- (void)setUp
{
    [super setUp];
}

// Teardown.
- (void)tearDown
{
    [super tearDown];
}

// Madgwick test A.
- (void)testMadgwickA
{
    // Test.
    NSString * sampleJSON = @"[{\"pitch\":0.5264893,\"gz\":0.0004721961,\"my\":0,\"yaw\":0.03433228,\"coreMotionRoll\":359.509,\"mz\":0,\"ax\":0.00856893,\"coreMotionPitch\":0.03717041,\"coreMotionYaw\":0.0003051758,\"gx\":0.000979821,\"ay\":0.0006486682,\"gy\":0.0001413785,\"az\":0.9999631,\"mx\":0,\"roll\":353.1229},{\"pitch\":359.9064,\"gz\":-0.00058764,\"my\":0,\"yaw\":0.004882812,\"coreMotionRoll\":359.5904,\"mz\":0,\"ax\":0.007148615,\"coreMotionPitch\":359.9442,\"coreMotionYaw\":0.003265381,\"gx\":-9.922422e-05,\"ay\":-0.0009733105,\"gy\":0.0001388151,\"az\":0.999974,\"mx\":0,\"roll\":0.004669189},{\"pitch\":0.2915344,\"gz\":-0.001647469,\"my\":0,\"yaw\":0.007385254,\"coreMotionRoll\":359.6066,\"mz\":0,\"ax\":0.006866026,\"coreMotionPitch\":359.9293,\"coreMotionYaw\":0.003875732,\"gx\":-0.00117847,\"ay\":-0.001234906,\"gy\":0.000138258,\"az\":0.9999757,\"mx\":0,\"roll\":353.111},{\"pitch\":359.911,\"gz\":0.0004648018,\"my\":0,\"yaw\":359.9985,\"coreMotionRoll\":359.6366,\"mz\":0,\"ax\":0.00634326,\"coreMotionPitch\":359.9267,\"coreMotionYaw\":0.005981445,\"gx\":0.000960644,\"ay\":-0.001279598,\"gy\":0.001242075,\"az\":0.9999791,\"mx\":0,\"roll\":0.01568604},{\"pitch\":1.100098,\"gz\":0.0004716274,\"my\":-18.01436,\"yaw\":2.781006,\"coreMotionRoll\":359.6564,\"mz\":-21.21292,\"ax\":0.00599631,\"coreMotionPitch\":359.917,\"coreMotionYaw\":0.009277344,\"gx\":-0.0001210217,\"ay\":-0.001449067,\"gy\":0.001269948,\"az\":0.999981,\"mx\":-39.24414,\"roll\":353.7953},{\"pitch\":2.127441,\"gz\":0.0004861102,\"my\":-18.2394,\"yaw\":6.087921,\"coreMotionRoll\":359.6654,\"mz\":-21.13721,\"ax\":0.005840272,\"coreMotionPitch\":359.9029,\"coreMotionYaw\":155.4675,\"gx\":-0.001221335,\"ay\":-0.001695231,\"gy\":0.0002259741,\"az\":0.9999815,\"mx\":-39.39549,\"roll\":347.8245},{\"pitch\":2.918884,\"gz\":-0.0005725962,\"my\":-18.08928,\"yaw\":9.976746,\"coreMotionRoll\":359.6707,\"mz\":-21.3631,\"ax\":0.005747447,\"coreMotionPitch\":359.8967,\"coreMotionYaw\":155.469,\"gx\":-0.001241715,\"ay\":-0.001802874,\"gy\":-0.000834419,\"az\":0.9999819,\"mx\":-39.24484,\"roll\":342.2617},{\"pitch\":3.395905,\"gz\":-0.0005935672,\"my\":-18.16438,\"yaw\":14.8356,\"coreMotionRoll\":359.6769,\"mz\":-21.13829,\"ax\":0.005639632,\"coreMotionPitch\":359.8953,\"coreMotionYaw\":155.4705,\"gx\":0.0008934455,\"ay\":-0.001827041,\"gy\":0.0002295439,\"az\":0.9999824,\"mx\":-39.245,\"roll\":337.5668},{\"pitch\":3.261566,\"gz\":-0.0005935144,\"my\":-17.71436,\"yaw\":20.87393,\"coreMotionRoll\":359.673,\"mz\":-21.21283,\"ax\":0.005707813,\"coreMotionPitch\":359.8964,\"coreMotionYaw\":155.4746,\"gx\":0.0008834388,\"ay\":-0.001809077,\"gy\":0.0001997134,\"az\":0.9999821,\"mx\":-39.16719,\"roll\":334.5395},{\"pitch\":2.743958,\"gz\":0.001545258,\"my\":-18.01414,\"yaw\":27.57236,\"coreMotionRoll\":359.6851,\"mz\":-21.59238,\"ax\":0.005496477,\"coreMotionPitch\":359.9007,\"coreMotionYaw\":155.4771,\"gx\":-0.001224232,\"ay\":-0.001733401,\"gy\":0.001313187,\"az\":0.9999834,\"mx\":-38.71971,\"roll\":334.1277},{\"pitch\":1.631714,\"gz\":0.0004798245,\"my\":-18.01424,\"yaw\":34.12677,\"coreMotionRoll\":359.6827,\"mz\":-21.4341,\"ax\":0.005537265,\"coreMotionPitch\":359.8982,\"coreMotionYaw\":155.4827,\"gx\":-0.0001730853,\"ay\":-0.001777576,\"gy\":0.0002277463,\"az\":0.9999831,\"mx\":-39.69447,\"roll\":334.4159},{\"pitch\":0.5903931,\"gz\":0.001601837,\"my\":-17.93913,\"yaw\":40.5376,\"coreMotionRoll\":359.6805,\"mz\":-21.66147,\"ax\":0.005575487,\"coreMotionPitch\":359.9007,\"coreMotionYaw\":155.4879,\"gx\":0.002010253,\"ay\":-0.00173293,\"gy\":0.001289319,\"az\":0.999983,\"mx\":-39.39432,\"roll\":335.0559},{\"pitch\":359.626,\"gz\":-0.0005246151,\"my\":-18.23932,\"yaw\":46.78391,\"coreMotionRoll\":359.6854,\"mz\":-21.28784,\"ax\":0.00549029,\"coreMotionPitch\":359.8986,\"coreMotionYaw\":155.491,\"gx\":0.0009288067,\"ay\":-0.001770687,\"gy\":0.001273021,\"az\":0.9999834,\"mx\":-39.32071,\"roll\":335.781},{\"pitch\":358.6909,\"gz\":0.0005717687,\"my\":-18.23929,\"yaw\":52.84467,\"coreMotionRoll\":359.6847,\"mz\":-21.36411,\"ax\":0.005503466,\"coreMotionPitch\":359.9033,\"coreMotionYaw\":155.4957,\"gx\":-0.001196151,\"ay\":-0.001687269,\"gy\":0.001287353,\"az\":0.9999834,\"mx\":-39.17082,\"roll\":336.6324},{\"pitch\":357.7881,\"gz\":-0.0005003662,\"my\":-18.08939,\"yaw\":58.73987,\"coreMotionRoll\":359.6848,\"mz\":-21.13684,\"ax\":0.00550069,\"coreMotionPitch\":359.9014,\"coreMotionYaw\":155.4998,\"gx\":0.000935566,\"ay\":-0.001720674,\"gy\":0.000214548,\"az\":0.9999834,\"mx\":-39.39452,\"roll\":337.522},{\"pitch\":356.9998,\"gz\":-0.0004932038,\"my\":-18.16438,\"yaw\":64.45319,\"coreMotionRoll\":359.6867,\"mz\":-21.13893,\"ax\":0.005467175,\"coreMotionPitch\":359.8968,\"coreMotionYaw\":155.5027,\"gx\":-0.0001344203,\"ay\":-0.001801449,\"gy\":0.000212512,\"az\":0.9999834,\"mx\":-39.17,\"roll\":338.5226},{\"pitch\":356.2814,\"gz\":-0.0004721422,\"my\":-17.86435,\"yaw\":69.97742,\"coreMotionRoll\":359.6789,\"mz\":-21.21701,\"ax\":0.005604142,\"coreMotionPitch\":359.9073,\"coreMotionYaw\":155.5059,\"gx\":-0.002268021,\"ay\":-0.001617905,\"gy\":-0.0008509943,\"az\":0.999983,\"mx\":-38.71817,\"roll\":339.584},{\"pitch\":355.6748,\"gz\":0.001621265,\"my\":-18.01428,\"yaw\":75.33875,\"coreMotionRoll\":359.6771,\"mz\":-21.36546,\"ax\":0.005635374,\"coreMotionPitch\":359.9055,\"coreMotionYaw\":155.5076,\"gx\":-0.0001259915,\"ay\":-0.001649251,\"gy\":0.002344245,\"az\":0.9999828,\"mx\":-38.94437,\"roll\":340.7151},{\"pitch\":355.1684,\"gz\":0.00162953,\"my\":-18.31429,\"yaw\":80.51544,\"coreMotionRoll\":359.6812,\"mz\":-21.36429,\"ax\":0.00556452,\"coreMotionPitch\":359.9016,\"coreMotionYaw\":155.5114,\"gx\":-0.002267306,\"ay\":-0.001718301,\"gy\":0.002341616,\"az\":0.999983,\"mx\":-39.17131,\"roll\":341.8837},{\"pitch\":354.7627,\"gz\":-0.0005025471,\"my\":-18.31416,\"yaw\":85.48795,\"coreMotionRoll\":359.6765,\"mz\":-21.58929,\"ax\":0.00564519,\"coreMotionPitch\":359.9017,\"coreMotionYaw\":155.517,\"gx\":-0.001207108,\"ay\":-0.001714817,\"gy\":0.001260646,\"az\":0.9999826,\"mx\":-39.17165,\"roll\":343.0611},{\"pitch\":354.4624,\"gz\":0.0005554502,\"my\":-18.53928,\"yaw\":90.25879,\"coreMotionRoll\":359.6874,\"mz\":-21.36676,\"ax\":0.005455916,\"coreMotionPitch\":359.8995,\"coreMotionYaw\":155.5216,\"gx\":-0.003344004,\"ay\":-0.001753647,\"gy\":0.003388743,\"az\":0.9999835,\"mx\":-38.94778,\"roll\":344.2699},{\"pitch\":354.2736,\"gz\":0.001610477,\"my\":-18.53929,\"yaw\":94.83987,\"coreMotionRoll\":359.6895,\"mz\":-21.29303,\"ax\":0.005420057,\"coreMotionPitch\":359.8964,\"coreMotionYaw\":155.5253,\"gx\":0.001997071,\"ay\":-0.001808128,\"gy\":-0.0008544789,\"az\":0.9999837,\"mx\":-38.79767,\"roll\":345.4387},{\"pitch\":354.117,\"gz\":0.0005417952,\"my\":-18.2394,\"yaw\":99.22943,\"coreMotionRoll\":359.6873,\"mz\":-21.14102,\"ax\":0.005457308,\"coreMotionPitch\":359.9012,\"coreMotionYaw\":155.5299,\"gx\":-0.0001431877,\"ay\":-0.001725242,\"gy\":0.001259688,\"az\":0.9999836,\"mx\":-38.9455,\"roll\":346.5743},{\"pitch\":354.0229,\"gz\":0.0005318171,\"my\":-18.08939,\"yaw\":103.4232,\"coreMotionRoll\":359.6794,\"mz\":-21.14003,\"ax\":0.005596395,\"coreMotionPitch\":359.9007,\"coreMotionYaw\":155.5335,\"gx\":-0.001214946,\"ay\":-0.001733326,\"gy\":0.002314281,\"az\":0.9999828,\"mx\":-39.01952,\"roll\":347.6774},{\"pitch\":354.0078,\"gz\":0.0005451886,\"my\":-18.31447,\"yaw\":107.4103,\"coreMotionRoll\":359.6784,\"mz\":-20.98802,\"ax\":0.005612301,\"coreMotionPitch\":359.8974,\"coreMotionYaw\":155.5372,\"gx\":-0.003353131,\"ay\":-0.001791405,\"gy\":0.002314666,\"az\":0.9999827,\"mx\":-39.32076,\"roll\":348.7499},{\"pitch\":354.0503,\"gz\":0.0005181289,\"my\":-17.86432,\"yaw\":111.2149,\"coreMotionRoll\":359.6768,\"mz\":-21.28629,\"ax\":0.005639995,\"coreMotionPitch\":359.8927,\"coreMotionYaw\":155.5414,\"gx\":0.001984719,\"ay\":-0.001872927,\"gy\":0.0001839434,\"az\":0.9999824,\"mx\":-39.39328,\"roll\":349.7408},{\"pitch\":354.1326,\"gz\":0.001607992,\"my\":-17.93916,\"yaw\":114.7867,\"coreMotionRoll\":359.6785,\"mz\":-21.58838,\"ax\":0.005610745,\"coreMotionPitch\":359.8929,\"coreMotionYaw\":155.5467,\"gx\":-0.004424463,\"ay\":-0.001868801,\"gy\":0.001250984,\"az\":0.9999825,\"mx\":-39.16922,\"roll\":350.7054},{\"pitch\":354.2748,\"gz\":0.0005337178,\"my\":-18.01405,\"yaw\":118.1411,\"coreMotionRoll\":359.68,\"mz\":-21.81163,\"ax\":0.005585566,\"coreMotionPitch\":359.8969,\"coreMotionYaw\":155.5484,\"gx\":-0.004427614,\"ay\":-0.001799988,\"gy\":0.00230322,\"az\":0.9999828,\"mx\":-39.39503,\"roll\":351.6176},{\"pitch\":354.5161,\"gz\":0.001573929,\"my\":-18.31421,\"yaw\":121.2901,\"coreMotionRoll\":359.6844,\"mz\":-21.51047,\"ax\":0.005508173,\"coreMotionPitch\":359.8969,\"coreMotionYaw\":155.5528,\"gx\":0.001984259,\"ay\":-0.001798682,\"gy\":-0.0008820838,\"az\":0.9999832,\"mx\":-39.62154,\"roll\":352.4596},{\"pitch\":354.8075,\"gz\":0.000482962,\"my\":-18.53923,\"yaw\":124.1971,\"coreMotionRoll\":359.6952,\"mz\":-21.43793,\"ax\":0.00532046,\"coreMotionPitch\":359.8993,\"coreMotionYaw\":155.5574,\"gx\":0.003046888,\"ay\":-0.00175722,\"gy\":0.0001624246,\"az\":0.9999843,\"mx\":-39.39789,\"roll\":353.2589},{\"pitch\":355.1059,\"gz\":0.001561856,\"my\":-18.68939,\"yaw\":126.8858,\"coreMotionRoll\":359.6972,\"mz\":-21.14021,\"ax\":0.005284442,\"coreMotionPitch\":359.9057,\"coreMotionYaw\":155.5623,\"gx\":-0.0001542046,\"ay\":-0.001645855,\"gy\":0.001234441,\"az\":0.9999847,\"mx\":-39.17342,\"roll\":354.0023},{\"pitch\":355.3894,\"gz\":0.002603529,\"my\":-18.38936,\"yaw\":129.4217,\"coreMotionRoll\":359.6907,\"mz\":-21.21255,\"ax\":0.005397901,\"coreMotionPitch\":359.9117,\"coreMotionYaw\":155.5687,\"gx\":0.00198162,\"ay\":-0.001541039,\"gy\":0.001235588,\"az\":0.9999843,\"mx\":-39.39658,\"roll\":354.652},{\"pitch\":355.6687,\"gz\":0.0004847745,\"my\":-18.38939,\"yaw\":131.7621,\"coreMotionRoll\":359.6879,\"mz\":-21.13629,\"ax\":0.005446805,\"coreMotionPitch\":359.908,\"coreMotionYaw\":155.5718,\"gx\":0.0009046478,\"ay\":-0.001605289,\"gy\":0.0001566671,\"az\":0.9999839,\"mx\":-39.54646,\"roll\":355.2295},{\"pitch\":355.92,\"gz\":0.0005062941,\"my\":-18.08934,\"yaw\":133.9038,\"coreMotionRoll\":359.6873,\"mz\":-21.21692,\"ax\":0.005458171,\"coreMotionPitch\":359.9076,\"coreMotionYaw\":155.5754,\"gx\":-0.00444238,\"ay\":-0.001612683,\"gy\":0.0001536806,\"az\":0.9999838,\"mx\":-38.79463,\"roll\":355.7503},{\"pitch\":356.1986,\"gz\":0.001534431,\"my\":-18.16428,\"yaw\":135.8723,\"coreMotionRoll\":359.6863,\"mz\":-21.36647,\"ax\":0.00547462,\"coreMotionPitch\":359.911,\"coreMotionYaw\":155.5792,\"gx\":-0.001236772,\"ay\":-0.00155253,\"gy\":0.00121535,\"az\":0.9999838,\"mx\":-38.87035,\"roll\":356.2238},{\"pitch\":356.4715,\"gz\":0.0004678846,\"my\":-18.31416,\"yaw\":137.6733,\"coreMotionRoll\":359.687,\"mz\":-21.58865,\"ax\":0.005462487,\"coreMotionPitch\":359.9157,\"coreMotionYaw\":155.583,\"gx\":-0.001240588,\"ay\":-0.001470953,\"gy\":0.00120634,\"az\":0.999984,\"mx\":-39.24664,\"roll\":356.643},{\"pitch\":356.7129,\"gz\":0.001535555,\"my\":-18.23914,\"yaw\":139.3323,\"coreMotionRoll\":359.6805,\"mz\":-21.66347,\"ax\":0.005575384,\"coreMotionPitch\":359.9179,\"coreMotionYaw\":155.5877,\"gx\":-0.004444705,\"ay\":-0.001432535,\"gy\":0.002269549,\"az\":0.9999834,\"mx\":-39.24628,\"roll\":357.0155},{\"pitch\":356.9751,\"gz\":-0.0006070503,\"my\":-18.31413,\"yaw\":140.8083,\"coreMotionRoll\":359.6846,\"mz\":-21.6662,\"ax\":0.005504036,\"coreMotionPitch\":359.9132,\"coreMotionYaw\":155.5912,\"gx\":-0.002317743,\"ay\":-0.00151554,\"gy\":0.0001205732,\"az\":0.9999837,\"mx\":-38.94676,\"roll\":357.3406},{\"pitch\":357.2334,\"gz\":0.0004406889,\"my\":-18.31436,\"yaw\":142.1909,\"coreMotionRoll\":359.6828,\"mz\":-21.21237,\"ax\":0.005536242,\"coreMotionPitch\":359.9135,\"coreMotionYaw\":155.5945,\"gx\":0.00195963,\"ay\":-0.001510022,\"gy\":-0.0009344265,\"az\":0.9999835,\"mx\":-39.39609,\"roll\":357.6137},{\"pitch\":357.4207,\"gz\":-0.0006419985,\"my\":-17.78943,\"yaw\":143.5224,\"coreMotionRoll\":359.6808,\"mz\":-21.05855,\"ax\":0.005571826,\"coreMotionPitch\":359.915,\"coreMotionYaw\":155.5983,\"gx\":-0.0001831505,\"ay\":-0.00148295,\"gy\":0.001170302,\"az\":0.9999834,\"mx\":-39.69244,\"roll\":357.8459},{\"pitch\":357.6596,\"gz\":0.0004323749,\"my\":-18.31444,\"yaw\":144.6353,\"coreMotionRoll\":359.6833,\"mz\":-21.06493,\"ax\":0.005526522,\"coreMotionPitch\":359.9124,\"coreMotionYaw\":155.6019,\"gx\":-0.0001798495,\"ay\":-0.001528975,\"gy\":0.0001182057,\"az\":0.9999835,\"mx\":-39.09587,\"roll\":358.0772},{\"pitch\":357.8608,\"gz\":0.001488912,\"my\":-18.01443,\"yaw\":145.6737,\"coreMotionRoll\":359.6803,\"mz\":-21.06612,\"ax\":0.005579283,\"coreMotionPitch\":359.9117,\"coreMotionYaw\":155.606,\"gx\":-0.000177448,\"ay\":-0.001540831,\"gy\":0.0001198155,\"az\":0.9999833,\"mx\":-38.86893,\"roll\":358.2698},{\"pitch\":358.0075,\"gz\":0.0004088411,\"my\":-17.63916,\"yaw\":146.6653,\"coreMotionRoll\":359.6817,\"mz\":-21.58827,\"ax\":0.005555403,\"coreMotionPitch\":359.9109,\"coreMotionYaw\":155.611,\"gx\":-0.001252046,\"ay\":-0.001555962,\"gy\":0.001166102,\"az\":0.9999834,\"mx\":-39.09227,\"roll\":358.4285},{\"pitch\":358.1768,\"gz\":0.002557534,\"my\":-17.93916,\"yaw\":147.5289,\"coreMotionRoll\":359.6823,\"mz\":-21.58965,\"ax\":0.005545975,\"coreMotionPitch\":359.9076,\"coreMotionYaw\":155.6157,\"gx\":-0.001245,\"ay\":-0.00161348,\"gy\":-0.0009387675,\"az\":0.9999833,\"mx\":-39.01921,\"roll\":358.5721},{\"pitch\":358.3682,\"gz\":-0.0006760737,\"my\":-18.31421,\"yaw\":148.248,\"coreMotionRoll\":359.6824,\"mz\":-21.51492,\"ax\":0.005542397,\"coreMotionPitch\":359.9034,\"coreMotionYaw\":155.6165,\"gx\":0.000878058,\"ay\":-0.001686718,\"gy\":8.802882e-05,\"az\":0.9999832,\"mx\":-39.09654,\"roll\":358.7157},{\"pitch\":358.5306,\"gz\":0.001444385,\"my\":-18.23917,\"yaw\":148.9154,\"coreMotionRoll\":359.6871,\"mz\":-21.59038,\"ax\":0.00546077,\"coreMotionPitch\":359.9043,\"coreMotionYaw\":155.6199,\"gx\":0.0008839994,\"ay\":-0.001670488,\"gy\":9.921527e-05,\"az\":0.9999837,\"mx\":-39.02116,\"roll\":358.8377},{\"pitch\":358.6822,\"gz\":0.001452167,\"my\":-18.53928,\"yaw\":149.5044,\"coreMotionRoll\":359.6908,\"mz\":-21.36293,\"ax\":0.005395923,\"coreMotionPitch\":359.9009,\"coreMotionYaw\":155.6214,\"gx\":0.0008832296,\"ay\":-0.001730008,\"gy\":-0.0009614732,\"az\":0.999984,\"mx\":-39.39778,\"roll\":358.942},{\"pitch\":358.8116,\"gz\":0.0003710037,\"my\":-18.61444,\"yaw\":150.0167,\"coreMotionRoll\":359.6853,\"mz\":-21.06375,\"ax\":0.005493084,\"coreMotionPitch\":359.9046,\"coreMotionYaw\":155.6238,\"gx\":-0.00125836,\"ay\":-0.001664342,\"gy\":0.001146106,\"az\":0.9999835,\"mx\":-39.32281,\"roll\":359.0448},{\"pitch\":358.922,\"gz\":0.002490931,\"my\":-18.31439,\"yaw\":150.5208,\"coreMotionRoll\":359.6854,\"mz\":-21.1393,\"ax\":0.005490921,\"coreMotionPitch\":359.9072,\"coreMotionYaw\":155.6289,\"gx\":0.000886303,\"ay\":-0.001619029,\"gy\":0.001163056,\"az\":0.9999836,\"mx\":-39.17097,\"roll\":359.1237},{\"pitch\":359.0396,\"gz\":0.0003535832,\"my\":-18.38936,\"yaw\":150.9379,\"coreMotionRoll\":359.6839,\"mz\":-21.21638,\"ax\":0.005517023,\"coreMotionPitch\":359.9078,\"coreMotionYaw\":155.6321,\"gx\":0.001946289,\"ay\":-0.001608678,\"gy\":-0.0009843793,\"az\":0.9999835,\"mx\":-38.94658,\"roll\":359.1859},{\"pitch\":359.0986,\"gz\":-0.0007263452,\"my\":-17.93947,\"yaw\":151.3752,\"coreMotionRoll\":359.6841,\"mz\":-20.98965,\"ax\":0.005512783,\"coreMotionPitch\":359.9089,\"coreMotionYaw\":155.6332,\"gx\":-0.0001948564,\"ay\":-0.001589929,\"gy\":0.00112442,\"az\":0.9999835,\"mx\":-39.01831,\"roll\":359.2368},{\"pitch\":359.1959,\"gz\":0.001393586,\"my\":-18.31424,\"yaw\":151.7253,\"coreMotionRoll\":359.6833,\"mz\":-21.44057,\"ax\":0.00552692,\"coreMotionPitch\":359.9092,\"coreMotionYaw\":155.6384,\"gx\":0.001949256,\"ay\":-0.001585012,\"gy\":0.001141037,\"az\":0.9999835,\"mx\":-39.02142,\"roll\":359.2956},{\"pitch\":359.2708,\"gz\":0.0003224445,\"my\":-18.08926,\"yaw\":152.0519,\"coreMotionRoll\":359.6842,\"mz\":-21.36693,\"ax\":0.005511577,\"coreMotionPitch\":359.906,\"coreMotionYaw\":155.6406,\"gx\":0.00194362,\"ay\":-0.001640038,\"gy\":6.564402e-05,\"az\":0.9999835,\"mx\":-38.79486,\"roll\":359.3361},{\"pitch\":359.3327,\"gz\":0.0003183155,\"my\":-18.08928,\"yaw\":152.3552,\"coreMotionRoll\":359.6872,\"mz\":-21.36565,\"ax\":0.005459195,\"coreMotionPitch\":359.9019,\"coreMotionYaw\":155.6425,\"gx\":0.001941743,\"ay\":-0.001712768,\"gy\":-0.001000705,\"az\":0.9999836,\"mx\":-38.94485,\"roll\":359.3657},{\"pitch\":359.3968,\"gz\":0.000323965,\"my\":-18.31419,\"yaw\":152.5854,\"coreMotionRoll\":359.6831,\"mz\":-21.51749,\"ax\":0.005530021,\"coreMotionPitch\":359.8974,\"coreMotionYaw\":155.6455,\"gx\":-0.0001958435,\"ay\":-0.001790159,\"gy\":6.14348e-05,\"az\":0.9999831,\"mx\":-38.79654,\"roll\":359.4079},{\"pitch\":359.4584,\"gz\":0.0002978705,\"my\":-18.46431,\"yaw\":152.7927,\"coreMotionRoll\":359.6838,\"mz\":-21.2903,\"ax\":0.005518876,\"coreMotionPitch\":359.8971,\"coreMotionYaw\":155.649,\"gx\":0.0008709485,\"ay\":-0.001796427,\"gy\":0.001116991,\"az\":0.9999831,\"mx\":-39.09718,\"roll\":359.4492},{\"pitch\":359.4964,\"gz\":0.002430052,\"my\":-18.31444,\"yaw\":153.0076,\"coreMotionRoll\":359.6801,\"mz\":-21.06557,\"ax\":0.005582965,\"coreMotionPitch\":359.8929,\"coreMotionYaw\":155.655,\"gx\":-0.0001904502,\"ay\":-0.00186848,\"gy\":0.002196129,\"az\":0.9999827,\"mx\":-39.02087,\"roll\":359.4843},{\"pitch\":359.5302,\"gz\":0.0003003032,\"my\":-18.31436,\"yaw\":153.1934,\"coreMotionRoll\":359.6832,\"mz\":-21.21492,\"ax\":0.005528975,\"coreMotionPitch\":359.8905,\"coreMotionYaw\":155.6588,\"gx\":-0.000199997,\"ay\":-0.001911107,\"gy\":5.067863e-05,\"az\":0.9999829,\"mx\":-39.09608,\"roll\":359.5024},{\"pitch\":359.5507,\"gz\":0.001362351,\"my\":-18.16431,\"yaw\":153.3761,\"coreMotionRoll\":359.6797,\"mz\":-21.29083,\"ax\":0.005589877,\"coreMotionPitch\":359.8876,\"coreMotionYaw\":155.6641,\"gx\":-0.001266798,\"ay\":-0.00196175,\"gy\":5.469121e-05,\"az\":0.9999825,\"mx\":-38.94524,\"roll\":359.5161},{\"pitch\":359.5828,\"gz\":-0.001858426,\"my\":-18.08936,\"yaw\":153.5321,\"coreMotionRoll\":359.6801,\"mz\":-21.21565,\"ax\":0.005582666,\"coreMotionPitch\":359.8938,\"coreMotionYaw\":155.6668,\"gx\":0.00085936,\"ay\":-0.001853688,\"gy\":0.001088615,\"az\":0.9999827,\"mx\":-38.94463,\"roll\":359.5336},{\"pitch\":359.61,\"gz\":0.0002865542,\"my\":-18.01416,\"yaw\":153.6886,\"coreMotionRoll\":359.6766,\"mz\":-21.59111,\"ax\":0.005643997,\"coreMotionPitch\":359.8948,\"coreMotionYaw\":155.6696,\"gx\":0.00086443,\"ay\":-0.001836,\"gy\":-0.002083542,\"az\":0.9999824,\"mx\":-38.86971,\"roll\":359.5301},{\"pitch\":359.6421,\"gz\":0.0002677446,\"my\":-18.31416,\"yaw\":153.8206,\"coreMotionRoll\":359.6695,\"mz\":-21.58737,\"ax\":0.005768515,\"coreMotionPitch\":359.8997,\"coreMotionYaw\":155.672,\"gx\":0.0008621584,\"ay\":-0.001751178,\"gy\":-0.001028397,\"az\":0.9999818,\"mx\":-39.39665,\"roll\":359.5369},{\"pitch\":359.6776,\"gz\":0.001346652,\"my\":-18.53912,\"yaw\":153.8875,\"coreMotionRoll\":359.6727,\"mz\":-21.66612,\"ax\":0.005712711,\"coreMotionPitch\":359.8927,\"coreMotionYaw\":155.675,\"gx\":-0.002340297,\"ay\":-0.00187299,\"gy\":4.35768e-05,\"az\":0.9999819,\"mx\":-39.02322,\"roll\":359.564},{\"pitch\":359.7129,\"gz\":0.002374081,\"my\":-18.46428,\"yaw\":153.9758,\"coreMotionRoll\":359.6767,\"mz\":-21.36465,\"ax\":0.005642672,\"coreMotionPitch\":359.8937,\"coreMotionYaw\":155.678,\"gx\":0.0008655287,\"ay\":-0.001855152,\"gy\":0.001107736,\"az\":0.9999824,\"mx\":-39.17229,\"roll\":359.5866},{\"pitch\":359.7239,\"gz\":0.0002553217,\"my\":-18.31429,\"yaw\":154.0709,\"coreMotionRoll\":359.6729,\"mz\":-21.36365,\"ax\":0.005708193,\"coreMotionPitch\":359.8948,\"coreMotionYaw\":155.6818,\"gx\":-0.0002102108,\"ay\":-0.001835916,\"gy\":2.929562e-05,\"az\":0.999982,\"mx\":-39.24631,\"roll\":359.5916},{\"pitch\":359.7473,\"gz\":0.000242449,\"my\":-18.53938,\"yaw\":154.1187,\"coreMotionRoll\":359.674,\"mz\":-21.13985,\"ax\":0.005689398,\"coreMotionPitch\":359.8947,\"coreMotionYaw\":155.6855,\"gx\":-0.001281816,\"ay\":-0.001837701,\"gy\":0.001086296,\"az\":0.9999821,\"mx\":-39.17244,\"roll\":359.6113},{\"pitch\":359.7703,\"gz\":0.000219234,\"my\":-18.31429,\"yaw\":154.1891,\"coreMotionRoll\":359.6696,\"mz\":-21.36493,\"ax\":0.005766772,\"coreMotionPitch\":359.8937,\"coreMotionYaw\":155.6887,\"gx\":0.001920773,\"ay\":-0.001855326,\"gy\":1.864502e-05,\"az\":0.9999816,\"mx\":-39.09631,\"roll\":359.6132},{\"pitch\":359.7554,\"gz\":-0.0008262666,\"my\":-18.08928,\"yaw\":154.2985,\"coreMotionRoll\":359.6705,\"mz\":-21.36183,\"ax\":0.005750468,\"coreMotionPitch\":359.8961,\"coreMotionYaw\":155.6918,\"gx\":-0.0002199278,\"ay\":-0.001813869,\"gy\":-0.001049811,\"az\":0.9999818,\"mx\":-39.39485,\"roll\":359.5996},{\"pitch\":359.7643,\"gz\":-0.000852853,\"my\":-18.08928,\"yaw\":154.3638,\"coreMotionRoll\":359.6667,\"mz\":-21.36565,\"ax\":0.005817236,\"coreMotionPitch\":359.8947,\"coreMotionYaw\":155.6954,\"gx\":-0.0002223363,\"ay\":-0.001837735,\"gy\":0.001067633,\"az\":0.9999814,\"mx\":-38.94485,\"roll\":359.6096},{\"pitch\":359.7414,\"gz\":0.0002006195,\"my\":-17.86411,\"yaw\":154.4743,\"coreMotionRoll\":359.6642,\"mz\":-21.73819,\"ax\":0.005859886,\"coreMotionPitch\":359.8987,\"coreMotionYaw\":155.6987,\"gx\":-0.002357262,\"ay\":-0.001767978,\"gy\":0.003195216,\"az\":0.9999813,\"mx\":-39.16895,\"roll\":359.6188},{\"pitch\":359.7838,\"gz\":0.002313891,\"my\":-18.38916,\"yaw\":154.5129,\"coreMotionRoll\":359.6642,\"mz\":-21.58884,\"ax\":0.005861111,\"coreMotionPitch\":359.9065,\"coreMotionYaw\":155.7029,\"gx\":0.0008558103,\"ay\":-0.001631279,\"gy\":0.003211278,\"az\":0.9999815,\"mx\":-39.24713,\"roll\":359.6435},{\"pitch\":359.8412,\"gz\":0.001245286,\"my\":-18.46422,\"yaw\":154.5028,\"coreMotionRoll\":359.6617,\"mz\":-21.44284,\"ax\":0.005905428,\"coreMotionPitch\":359.9144,\"coreMotionYaw\":155.7062,\"gx\":0.001919213,\"ay\":-0.001493907,\"gy\":0.001075008,\"az\":0.9999815,\"mx\":-38.79741,\"roll\":359.6578},{\"pitch\":359.8787,\"gz\":0.000178749,\"my\":-18.53928,\"yaw\":154.4913,\"coreMotionRoll\":359.6616,\"mz\":-21.36676,\"ax\":0.005905708,\"coreMotionPitch\":359.9118,\"coreMotionYaw\":155.7085,\"gx\":0.001915198,\"ay\":-0.001538745,\"gy\":0.001066701,\"az\":0.9999814,\"mx\":-38.94778,\"roll\":359.6668},{\"pitch\":359.8863,\"gz\":0.0001884511,\"my\":-18.53935,\"yaw\":154.4988,\"coreMotionRoll\":359.6617,\"mz\":-21.21484,\"ax\":0.005903488,\"coreMotionPitch\":359.9173,\"coreMotionYaw\":155.7122,\"gx\":-0.0002242047,\"ay\":-0.001443823,\"gy\":2.554371e-06,\"az\":0.9999815,\"mx\":-39.17256,\"roll\":359.6633},{\"pitch\":359.8768,\"gz\":-0.0008971599,\"my\":-18.23938,\"yaw\":154.5172,\"coreMotionRoll\":359.6648,\"mz\":-21.1423,\"ax\":0.005849991,\"coreMotionPitch\":359.9123,\"coreMotionYaw\":155.7166,\"gx\":-0.001299684,\"ay\":-0.00153151,\"gy\":0.002113198,\"az\":0.9999817,\"mx\":-38.7955,\"roll\":359.6696},{\"pitch\":359.8603,\"gz\":0.001237156,\"my\":-18.08939,\"yaw\":154.5763,\"coreMotionRoll\":359.664,\"mz\":-21.14066,\"ax\":0.005864511,\"coreMotionPitch\":359.904,\"coreMotionYaw\":155.719,\"gx\":-0.0002242621,\"ay\":-0.001675481,\"gy\":0.001068724,\"az\":0.9999814,\"mx\":-38.94452,\"roll\":359.662},{\"pitch\":359.8472,\"gz\":-0.0008982651,\"my\":-18.08928,\"yaw\":154.6257,\"coreMotionRoll\":359.6601,\"mz\":-21.36438,\"ax\":0.00593221,\"coreMotionPitch\":359.9021,\"coreMotionYaw\":155.7214,\"gx\":-0.0002350071,\"ay\":-0.001708112,\"gy\":-1.464539e-05,\"az\":0.9999809,\"mx\":-39.09485,\"roll\":359.6491},{\"pitch\":359.8421,\"gz\":0.002284326,\"my\":-18.08916,\"yaw\":154.6852,\"coreMotionRoll\":359.667,\"mz\":-21.58937,\"ax\":0.005811661,\"coreMotionPitch\":359.906,\"coreMotionYaw\":155.7257,\"gx\":-0.000226808,\"ay\":-0.001640512,\"gy\":0.001068849,\"az\":0.9999818,\"mx\":-39.09518,\"roll\":359.6495},{\"pitch\":359.8734,\"gz\":0.002284387,\"my\":-18.4641,\"yaw\":154.6684,\"coreMotionRoll\":359.6665,\"mz\":-21.7422,\"ax\":0.005820593,\"coreMotionPitch\":359.9047,\"coreMotionYaw\":155.7283,\"gx\":-0.0002274263,\"ay\":-0.001663727,\"gy\":0.001069049,\"az\":0.9999817,\"mx\":-38.87286,\"roll\":359.6662},{\"pitch\":359.8829,\"gz\":0.001216387,\"my\":-18.38916,\"yaw\":154.6761,\"coreMotionRoll\":359.6671,\"mz\":-21.5901,\"ax\":0.005810787,\"coreMotionPitch\":359.9101,\"coreMotionYaw\":155.731,\"gx\":-0.0002337184,\"ay\":-0.001568523,\"gy\":-5.808123e-06,\"az\":0.9999819,\"mx\":-39.09714,\"roll\":359.6656},{\"pitch\":359.9116,\"gz\":0.0001565078,\"my\":-18.68915,\"yaw\":154.614,\"coreMotionRoll\":359.662,\"mz\":-21.5934,\"ax\":0.005899329,\"coreMotionPitch\":359.9053,\"coreMotionYaw\":155.7327,\"gx\":-0.001306321,\"ay\":-0.001652278,\"gy\":-1.414373e-05,\"az\":0.9999812,\"mx\":-38.79909,\"roll\":359.6776},{\"pitch\":359.9003,\"gz\":0.002294919,\"my\":-18.31438,\"yaw\":154.6218,\"coreMotionRoll\":359.6581,\"mz\":-21.14313,\"ax\":0.005966361,\"coreMotionPitch\":359.909,\"coreMotionYaw\":155.7365,\"gx\":-0.002370207,\"ay\":-0.001589088,\"gy\":-0.001062803,\"az\":0.9999809,\"mx\":-38.72098,\"roll\":359.6664},{\"pitch\":359.8978,\"gz\":0.001198698,\"my\":-18.31451,\"yaw\":154.6373,\"coreMotionRoll\":359.6576,\"mz\":-20.91621,\"ax\":0.005976182,\"coreMotionPitch\":359.9089,\"coreMotionYaw\":155.7399,\"gx\":-0.0002405035,\"ay\":-0.001589527,\"gy\":-1.635341e-05,\"az\":0.9999809,\"mx\":-38.94565,\"roll\":359.6612},{\"pitch\":359.8803,\"gz\":0.002249905,\"my\":-18.01439,\"yaw\":154.6942,\"coreMotionRoll\":359.6583,\"mz\":-21.14111,\"ax\":0.005963117,\"coreMotionPitch\":359.9108,\"coreMotionYaw\":155.7422,\"gx\":-0.0002367597,\"ay\":-0.001557356,\"gy\":0.002115191,\"az\":0.999981,\"mx\":-38.86903,\"roll\":359.6617},{\"pitch\":359.8997,\"gz\":0.0001169614,\"my\":-18.38951,\"yaw\":154.6834,\"coreMotionRoll\":359.6585,\"mz\":-20.9164,\"ax\":0.005960138,\"coreMotionPitch\":359.9127,\"coreMotionYaw\":155.7455,\"gx\":0.00082065,\"ay\":-0.00152324,\"gy\":-3.083424e-05,\"az\":0.9999811,\"mx\":-38.94614,\"roll\":359.6624},{\"pitch\":359.8754,\"gz\":0.0001087592,\"my\":-17.93921,\"yaw\":154.7589,\"coreMotionRoll\":359.6603,\"mz\":-21.51274,\"ax\":0.005928389,\"coreMotionPitch\":359.9172,\"coreMotionYaw\":155.7483,\"gx\":0.0008169377,\"ay\":-0.00144579,\"gy\":-3.622272e-05,\"az\":0.9999814,\"mx\":-39.24409,\"roll\":359.645},{\"pitch\":359.8825,\"gz\":0.0022508,\"my\":-18.01428,\"yaw\":154.8048,\"coreMotionRoll\":359.6567,\"mz\":-21.36546,\"ax\":0.00599105,\"coreMotionPitch\":359.9157,\"coreMotionYaw\":155.7526,\"gx\":0.001892513,\"ay\":-0.001470521,\"gy\":-0.002141378,\"az\":0.999981,\"mx\":-38.94437,\"roll\":359.6291},{\"pitch\":359.9279,\"gz\":0.001124281,\"my\":-18.38916,\"yaw\":154.7852,\"coreMotionRoll\":359.6555,\"mz\":-21.59138,\"ax\":0.006012325,\"coreMotionPitch\":359.921,\"coreMotionYaw\":155.7544,\"gx\":0.004022044,\"ay\":-0.001378863,\"gy\":0.00314972,\"az\":0.999981,\"mx\":-38.94714,\"roll\":359.6591},{\"pitch\":359.9285,\"gz\":0.0001142053,\"my\":-18.38928,\"yaw\":154.7657,\"coreMotionRoll\":359.6596,\"mz\":-21.36638,\"ax\":0.005941701,\"coreMotionPitch\":359.9223,\"coreMotionYaw\":155.7583,\"gx\":-0.001324355,\"ay\":-0.001356568,\"gy\":-3.943795e-05,\"az\":0.9999814,\"mx\":-38.94681,\"roll\":359.6627},{\"pitch\":359.9272,\"gz\":0.001159225,\"my\":-18.31424,\"yaw\":154.7803,\"coreMotionRoll\":359.6572,\"mz\":-21.43929,\"ax\":0.005982703,\"coreMotionPitch\":359.9214,\"coreMotionYaw\":155.761,\"gx\":0.0008127298,\"ay\":-0.001371237,\"gy\":-3.747539e-05,\"az\":0.9999812,\"mx\":-39.17143,\"roll\":359.6584},{\"pitch\":359.9293,\"gz\":0.00113701,\"my\":-18.2394,\"yaw\":154.7987,\"coreMotionRoll\":359.6617,\"mz\":-21.13976,\"ax\":0.005904581,\"coreMotionPitch\":359.9175,\"coreMotionYaw\":155.763,\"gx\":0.001877649,\"ay\":-0.001439381,\"gy\":0.001018284,\"az\":0.9999815,\"mx\":-39.09549,\"roll\":359.6617},{\"pitch\":359.9007,\"gz\":0.0001002991,\"my\":-17.8644,\"yaw\":154.868,\"coreMotionRoll\":359.664,\"mz\":-21.1382,\"ax\":0.005863473,\"coreMotionPitch\":359.9219,\"coreMotionYaw\":155.765,\"gx\":0.0008056783,\"ay\":-0.001363285,\"gy\":-0.002173202,\"az\":0.9999819,\"mx\":-39.16805,\"roll\":359.6357},{\"pitch\":359.902,\"gz\":-0.001005166,\"my\":-17.86438,\"yaw\":154.881,\"coreMotionRoll\":359.6636,\"mz\":-21.1433,\"ax\":0.00587072,\"coreMotionPitch\":359.9174,\"coreMotionYaw\":155.7661,\"gx\":0.0007983968,\"ay\":-0.001441308,\"gy\":0.002057342,\"az\":0.9999817,\"mx\":-38.56805,\"roll\":359.6506},{\"pitch\":359.8935,\"gz\":5.410878e-05,\"my\":-17.78923,\"yaw\":154.9343,\"coreMotionRoll\":359.6636,\"mz\":-21.43991,\"ax\":0.005870806,\"coreMotionPitch\":359.9207,\"coreMotionYaw\":155.7689,\"gx\":0.00186675,\"ay\":-0.00138456,\"gy\":0.0009994169,\"az\":0.9999818,\"mx\":-38.94301,\"roll\":359.6479},{\"pitch\":359.9095,\"gz\":6.854608e-05,\"my\":-18.01427,\"yaw\":154.9335,\"coreMotionRoll\":359.6608,\"mz\":-21.36739,\"ax\":0.005920298,\"coreMotionPitch\":359.9296,\"coreMotionYaw\":155.7714,\"gx\":0.0007986229,\"ay\":-0.001228037,\"gy\":-6.097496e-05,\"az\":0.9999817,\"mx\":-38.71938,\"roll\":359.6511},{\"pitch\":359.9266,\"gz\":8.220971e-05,\"my\":-18.2392,\"yaw\":154.9061,\"coreMotionRoll\":359.6626,\"mz\":-21.5173,\"ax\":0.005888144,\"coreMotionPitch\":359.9278,\"coreMotionYaw\":155.7736,\"gx\":-0.0002743814,\"ay\":-0.001260467,\"gy\":-0.002187825,\"az\":0.9999819,\"mx\":-38.79605,\"roll\":359.6481},{\"pitch\":359.9484,\"gz\":0.001127827,\"my\":-18.2392,\"yaw\":154.8887,\"coreMotionRoll\":359.6602,\"mz\":-21.5173,\"ax\":0.005930542,\"coreMotionPitch\":359.9287,\"coreMotionYaw\":155.7751,\"gx\":0.00186594,\"ay\":-0.001243927,\"gy\":-0.001118763,\"az\":0.9999816,\"mx\":-38.79605,\"roll\":359.6502},{\"pitch\":359.955,\"gz\":0.001124712,\"my\":-18.38921,\"yaw\":154.8632,\"coreMotionRoll\":359.6668,\"mz\":-21.51639,\"ax\":0.005815781,\"coreMotionPitch\":359.9264,\"coreMotionYaw\":155.7782,\"gx\":-0.0002766182,\"ay\":-0.001284062,\"gy\":-6.098098e-05,\"az\":0.9999822,\"mx\":-38.94702,\"roll\":359.661},{\"pitch\":359.9499,\"gz\":0.001109007,\"my\":-18.2394,\"yaw\":154.8578,\"coreMotionRoll\":359.6606,\"mz\":-21.14166,\"ax\":0.005922814,\"coreMotionPitch\":359.9247,\"coreMotionYaw\":155.7823,\"gx\":-0.0002823584,\"ay\":-0.001313822,\"gy\":0.0009953977,\"az\":0.9999816,\"mx\":-38.8705,\"roll\":359.6681},{\"pitch\":359.9657,\"gz\":4.913116e-05,\"my\":-18.53937,\"yaw\":154.7884,\"coreMotionRoll\":359.6642,\"mz\":-21.14432,\"ax\":0.005860441,\"coreMotionPitch\":359.9213,\"coreMotionYaw\":155.7842,\"gx\":-0.001354884,\"ay\":-0.001373942,\"gy\":0.0009879353,\"az\":0.9999819,\"mx\":-38.64745,\"roll\":359.6866},{\"pitch\":359.9386,\"gz\":2.78604e-05,\"my\":-17.86423,\"yaw\":154.8312,\"coreMotionRoll\":359.6661,\"mz\":-21.44202,\"ax\":0.005827811,\"coreMotionPitch\":359.9259,\"coreMotionYaw\":155.7871,\"gx\":0.0007762215,\"ay\":-0.00129347,\"gy\":0.0009824397,\"az\":0.9999822,\"mx\":-38.71851,\"roll\":359.6759},{\"pitch\":359.9365,\"gz\":0.001095574,\"my\":-17.93927,\"yaw\":154.852,\"coreMotionRoll\":359.6679,\"mz\":-21.36847,\"ax\":0.005795379,\"coreMotionPitch\":359.9203,\"coreMotionYaw\":155.7909,\"gx\":0.001841511,\"ay\":-0.001390649,\"gy\":-0.001136112,\"az\":0.9999822,\"mx\":-38.56888,\"roll\":359.6636},{\"pitch\":359.9454,\"gz\":3.569209e-05,\"my\":-18.08914,\"yaw\":154.8372,\"coreMotionRoll\":359.668,\"mz\":-21.59448,\"ax\":0.00579413,\"coreMotionPitch\":359.9279,\"coreMotionYaw\":155.7944,\"gx\":0.0007696724,\"ay\":-0.001259047,\"gy\":-0.001144375,\"az\":0.9999824,\"mx\":-38.49519,\"roll\":359.6614},{\"pitch\":359.9269,\"gz\":0.001081324,\"my\":-17.86421,\"yaw\":154.908,\"coreMotionRoll\":359.6652,\"mz\":-21.5132,\"ax\":0.005843141,\"coreMotionPitch\":359.9301,\"coreMotionYaw\":155.7946,\"gx\":0.002903674,\"ay\":-0.001219491,\"gy\":-0.001140548,\"az\":0.9999822,\"mx\":-39.16861,\"roll\":359.6419},{\"pitch\":359.9437,\"gz\":0.00108032,\"my\":-18.16411,\"yaw\":154.9007,\"coreMotionRoll\":359.6626,\"mz\":-21.66711,\"ax\":0.0058885,\"coreMotionPitch\":359.9286,\"coreMotionYaw\":155.7983,\"gx\":0.001834843,\"ay\":-0.001246833,\"gy\":-7.860897e-05,\"az\":0.9999819,\"mx\":-38.79579,\"roll\":359.65},{\"pitch\":359.9607,\"gz\":-0.001062647,\"my\":-18.5392,\"yaw\":154.8401,\"coreMotionRoll\":359.663,\"mz\":-21.51675,\"ax\":0.005882406,\"coreMotionPitch\":359.9214,\"coreMotionYaw\":155.8016,\"gx\":-0.0003168708,\"ay\":-0.001372168,\"gy\":0.002023863,\"az\":0.9999818,\"mx\":-38.948,\"roll\":359.676},{\"pitch\":359.9751,\"gz\":-3.725319e-06,\"my\":-18.38914,\"yaw\":154.7792,\"coreMotionRoll\":359.6585,\"mz\":-21.59584,\"ax\":0.005960548,\"coreMotionPitch\":359.9199,\"coreMotionYaw\":155.8051,\"gx\":-0.0003201356,\"ay\":-0.001398777,\"gy\":0.00202894,\"az\":0.9999813,\"mx\":-38.42215,\"roll\":359.6944},{\"pitch\":359.9478,\"gz\":0.001086104,\"my\":-18.16438,\"yaw\":154.8015,\"coreMotionRoll\":359.6562,\"mz\":-21.14084,\"ax\":0.006001029,\"coreMotionPitch\":359.913,\"coreMotionYaw\":155.8081,\"gx\":-0.0003170621,\"ay\":-0.001518569,\"gy\":-0.001145929,\"az\":0.9999809,\"mx\":-38.94501,\"roll\":359.6728},{\"pitch\":359.9492,\"gz\":-1.810729e-05,\"my\":-18.23935,\"yaw\":154.787,\"coreMotionRoll\":359.6555,\"mz\":-21.21793,\"ax\":0.006012845,\"coreMotionPitch\":359.9166,\"coreMotionYaw\":155.8105,\"gx\":0.0007412111,\"ay\":-0.001454916,\"gy\":0.002024856,\"az\":0.9999809,\"mx\":-38.72061,\"roll\":359.681},{\"pitch\":359.9413,\"gz\":-0.001069375,\"my\":-17.8643,\"yaw\":154.7874,\"coreMotionRoll\":359.6542,\"mz\":-21.29648,\"ax\":0.006035341,\"coreMotionPitch\":359.918,\"coreMotionYaw\":155.812,\"gx\":0.0007306023,\"ay\":-0.00143063,\"gy\":-0.001171363,\"az\":0.9999807,\"mx\":-38.19328,\"roll\":359.6646},{\"pitch\":359.908,\"gz\":0.002122753,\"my\":-17.78928,\"yaw\":154.8655,\"coreMotionRoll\":359.658,\"mz\":-21.36491,\"ax\":0.005969443,\"coreMotionPitch\":359.9176,\"coreMotionYaw\":155.8146,\"gx\":0.0007415022,\"ay\":-0.001438308,\"gy\":-8.313576e-05,\"az\":0.9999812,\"mx\":-38.9429,\"roll\":359.6474},{\"pitch\":359.9121,\"gz\":-2.616154e-05,\"my\":-18.08913,\"yaw\":154.8723,\"coreMotionRoll\":359.6625,\"mz\":-21.66629,\"ax\":0.005890884,\"coreMotionPitch\":359.9182,\"coreMotionYaw\":155.8158,\"gx\":0.0007270203,\"ay\":-0.001427203,\"gy\":0.0009576986,\"az\":0.9999816,\"mx\":-38.8703,\"roll\":359.655},{\"pitch\":359.8958,\"gz\":-2.050936e-05,\"my\":-18.01402,\"yaw\":154.8943,\"coreMotionRoll\":359.6563,\"mz\":-21.89046,\"ax\":0.005997957,\"coreMotionPitch\":359.9169,\"coreMotionYaw\":155.8181,\"gx\":-0.001410058,\"ay\":-0.001450792,\"gy\":0.002019742,\"az\":0.999981,\"mx\":-38.94514,\"roll\":359.6608},{\"pitch\":359.8979,\"gz\":-0.001088004,\"my\":-18.31416,\"yaw\":154.8795,\"coreMotionRoll\":359.6522,\"mz\":-21.58929,\"ax\":0.006070395,\"coreMotionPitch\":359.9136,\"coreMotionYaw\":155.8198,\"gx\":-0.001421549,\"ay\":-0.00150778,\"gy\":0.0009465707,\"az\":0.9999804,\"mx\":-39.17165,\"roll\":359.6646},{\"pitch\":359.8875,\"gz\":0.001032306,\"my\":-18.01428,\"yaw\":154.936,\"coreMotionRoll\":359.6476,\"mz\":-21.36165,\"ax\":0.006150594,\"coreMotionPitch\":359.9073,\"coreMotionYaw\":155.8235,\"gx\":0.00178377,\"ay\":-0.001617995,\"gy\":-0.001162973,\"az\":0.9999798,\"mx\":-39.39436,\"roll\":359.642},{\"pitch\":359.9281,\"gz\":0.001039025,\"my\":-18.6144,\"yaw\":154.8738,\"coreMotionRoll\":359.6471,\"mz\":-21.14131,\"ax\":0.00615899,\"coreMotionPitch\":359.9081,\"coreMotionYaw\":155.8264,\"gx\":0.0007152386,\"ay\":-0.00160405,\"gy\":-0.001162,\"az\":0.9999797,\"mx\":-39.02293,\"roll\":359.651},{\"pitch\":359.9289,\"gz\":-0.002163854,\"my\":-18.38931,\"yaw\":154.8312,\"coreMotionRoll\":359.6569,\"mz\":-21.29138,\"ax\":0.0059877,\"coreMotionPitch\":359.909,\"coreMotionYaw\":155.827,\"gx\":-0.001440003,\"ay\":-0.001588832,\"gy\":-0.0001279038,\"az\":0.9999808,\"mx\":-38.94669,\"roll\":359.658},{\"pitch\":359.9239,\"gz\":0.00100519,\"my\":-18.31429,\"yaw\":154.832,\"coreMotionRoll\":359.6603,\"mz\":-21.36493,\"ax\":0.005929435,\"coreMotionPitch\":359.9109,\"coreMotionYaw\":155.8292,\"gx\":-0.0003676236,\"ay\":-0.001554985,\"gy\":0.002018483,\"az\":0.9999812,\"mx\":-39.09631,\"roll\":359.67},{\"pitch\":359.9006,\"gz\":-3.04549e-05,\"my\":-18.0891,\"yaw\":154.8741,\"coreMotionRoll\":359.6591,\"mz\":-21.73746,\"ax\":0.005948895,\"coreMotionPitch\":359.9168,\"coreMotionYaw\":155.8313,\"gx\":-0.0003708867,\"ay\":-0.001451327,\"gy\":-0.002235075,\"az\":0.9999812,\"mx\":-39.3204,\"roll\":359.645},{\"pitch\":359.9078,\"gz\":-6.88315e-05,\"my\":-18.16428,\"yaw\":154.8736,\"coreMotionRoll\":359.6614,\"mz\":-21.36583,\"ax\":0.005908887,\"coreMotionPitch\":359.9109,\"coreMotionYaw\":155.8313,\"gx\":0.0006895815,\"ay\":-0.001554255,\"gy\":0.0009464303,\"az\":0.9999813,\"mx\":-38.94534,\"roll\":359.6544},{\"pitch\":359.8741,\"gz\":0.001019934,\"my\":-17.93921,\"yaw\":154.9464,\"coreMotionRoll\":359.6666,\"mz\":-21.51082,\"ax\":0.005818787,\"coreMotionPitch\":359.9037,\"coreMotionYaw\":155.8331,\"gx\":-0.0003755821,\"ay\":-0.001681595,\"gy\":-0.001166198,\"az\":0.9999816,\"mx\":-39.4691,\"roll\":359.6369},{\"pitch\":359.8997,\"gz\":-0.001128626,\"my\":-18.38913,\"yaw\":154.9127,\"coreMotionRoll\":359.6644,\"mz\":-21.66447,\"ax\":0.005857465,\"coreMotionPitch\":359.9039,\"coreMotionYaw\":155.8342,\"gx\":0.0006781357,\"ay\":-0.001677349,\"gy\":-0.001185907,\"az\":0.9999815,\"mx\":-39.17226,\"roll\":359.6441},{\"pitch\":359.8892,\"gz\":-6.672789e-05,\"my\":-18.53928,\"yaw\":154.8892,\"coreMotionRoll\":359.6684,\"mz\":-21.36229,\"ax\":0.005786981,\"coreMotionPitch\":359.8938,\"coreMotionYaw\":155.8386,\"gx\":-0.003598522,\"ay\":-0.001853216,\"gy\":0.002008032,\"az\":0.9999815,\"mx\":-39.47278,\"roll\":359.6664},{\"pitch\":359.891,\"gz\":-0.001137792,\"my\":-18.4642,\"yaw\":154.8833,\"coreMotionRoll\":359.6646,\"mz\":-21.51083,\"ax\":0.005854308,\"coreMotionPitch\":359.9018,\"coreMotionYaw\":155.8406,\"gx\":-0.0003965655,\"ay\":-0.001713317,\"gy\":-0.0001247618,\"az\":0.9999814,\"mx\":-39.62251,\"roll\":359.6645},{\"pitch\":359.8979,\"gz\":-8.093432e-05,\"my\":-18.46428,\"yaw\":154.8588,\"coreMotionRoll\":359.6733,\"mz\":-21.36401,\"ax\":0.005701552,\"coreMotionPitch\":359.9037,\"coreMotionYaw\":155.8414,\"gx\":-0.001467434,\"ay\":-0.001681254,\"gy\":0.0009459883,\"az\":0.9999824,\"mx\":-39.24728,\"roll\":359.6767},{\"pitch\":359.8862,\"gz\":0.0009794546,\"my\":-18.08939,\"yaw\":154.9023,\"coreMotionRoll\":359.6749,\"mz\":-21.13748,\"ax\":0.005673563,\"coreMotionPitch\":359.903,\"coreMotionYaw\":155.8415,\"gx\":0.0006673924,\"ay\":-0.00169191,\"gy\":-0.001168901,\"az\":0.9999825,\"mx\":-39.31952,\"roll\":359.6613},{\"pitch\":359.8816,\"gz\":0.002040521,\"my\":-17.93906,\"yaw\":154.9713,\"coreMotionRoll\":359.6729,\"mz\":-21.81145,\"ax\":0.005708294,\"coreMotionPitch\":359.9087,\"coreMotionYaw\":155.844,\"gx\":0.0028079,\"ay\":-0.001593561,\"gy\":-0.002222034,\"az\":0.9999824,\"mx\":-39.39455,\"roll\":359.6398},{\"pitch\":359.8874,\"gz\":-0.0001093571,\"my\":-18.08916,\"yaw\":154.9985,\"coreMotionRoll\":359.6671,\"mz\":-21.58682,\"ax\":0.005809215,\"coreMotionPitch\":359.9113,\"coreMotionYaw\":155.8464,\"gx\":0.001726137,\"ay\":-0.001548384,\"gy\":-0.0001169273,\"az\":0.9999819,\"mx\":-39.39519,\"roll\":359.6408},{\"pitch\":359.8742,\"gz\":0.0009871266,\"my\":-17.86417,\"yaw\":155.0607,\"coreMotionRoll\":359.6652,\"mz\":-21.58627,\"ax\":0.005843685,\"coreMotionPitch\":359.9178,\"coreMotionYaw\":155.8468,\"gx\":0.0006616887,\"ay\":-0.001435604,\"gy\":-0.00329125,\"az\":0.9999819,\"mx\":-39.39372,\"roll\":359.6176},{\"pitch\":359.8598,\"gz\":0.0009618782,\"my\":-17.86414,\"yaw\":155.1042,\"coreMotionRoll\":359.67,\"mz\":-21.66255,\"ax\":0.005758945,\"coreMotionPitch\":359.9113,\"coreMotionYaw\":155.8492,\"gx\":-0.001481076,\"ay\":-0.001548762,\"gy\":0.000955312,\"az\":0.9999822,\"mx\":-39.24384,\"roll\":359.6297},{\"pitch\":359.894,\"gz\":-0.0001161748,\"my\":-18.31416,\"yaw\":155.082,\"coreMotionRoll\":359.669,\"mz\":-21.58737,\"ax\":0.005776789,\"coreMotionPitch\":359.9093,\"coreMotionYaw\":155.8497,\"gx\":0.001716102,\"ay\":-0.001582565,\"gy\":-0.001177735,\"az\":0.9999821,\"mx\":-39.39665,\"roll\":359.639},{\"pitch\":359.9231,\"gz\":-0.001199222,\"my\":-18.4642,\"yaw\":155.0324,\"coreMotionRoll\":359.6638,\"mz\":-21.51338,\"ax\":0.00586744,\"coreMotionPitch\":359.9129,\"coreMotionYaw\":155.8518,\"gx\":0.0006439787,\"ay\":-0.001520748,\"gy\":0.001997693,\"az\":0.9999816,\"mx\":-39.32251,\"roll\":359.6658},{\"pitch\":359.9205,\"gz\":-0.001183938,\"my\":-18.08928,\"yaw\":155.0194,\"coreMotionRoll\":359.6635,\"mz\":-21.36565,\"ax\":0.005873903,\"coreMotionPitch\":359.9113,\"coreMotionYaw\":155.8521,\"gx\":-0.0004283994,\"ay\":-0.001548714,\"gy\":-0.0001248647,\"az\":0.9999815,\"mx\":-38.94485,\"roll\":359.6652},{\"pitch\":359.9661,\"gz\":-0.00134532,\"my\":-18.31432,\"yaw\":154.9901,\"coreMotionRoll\":359.6526,\"mz\":-21.28929,\"ax\":0.00606255,\"coreMotionPitch\":359.9108,\"coreMotionYaw\":155.8541,\"gx\":0.007046946,\"ay\":-0.001557158,\"gy\":0.01472897,\"az\":0.9999804,\"mx\":-39.1712,\"roll\":359.7451}]";
    NSData * sampleData = [sampleJSON dataUsingEncoding:NSUTF8StringEncoding];
    NSError * error;
    NSArray<NSDictionary *> * samples = (NSArray<NSDictionary *> *)[NSJSONSerialization JSONObjectWithData:sampleData
                                                                                                   options:0
                                                                                                     error:&error];
    MadgwickSensorFusion * madgwickSensorFusion = [[MadgwickSensorFusion alloc] initWithSampleFrequencyHz:10.0
                                                                                                     beta:0.6045997880780726f];
    for (NSDictionary * sample in samples)
    {
        [madgwickSensorFusion updateWithGyroscopeX:[sample[@"gx"] floatValue]
                                        gyroscopeY:[sample[@"gy"] floatValue]
                                        gyroscopeZ:[sample[@"gz"] floatValue]
                                    accelerometerX:[sample[@"ax"] floatValue]
                                    accelerometerY:[sample[@"ay"] floatValue]
                                    accelerometerZ:[sample[@"az"] floatValue]
                                     magnetometerX:[sample[@"mx"] floatValue]
                                     magnetometerY:[sample[@"my"] floatValue]
                                     magnetometerZ:[sample[@"mz"] floatValue]];
    }
    
    // Calculate roll, pitch, yaw.
    float roll, pitch, yaw;
    CalculateEulerAnglesFromQuaternion([madgwickSensorFusion q0],
                                       [madgwickSensorFusion q1],
                                       [madgwickSensorFusion q2],
                                       [madgwickSensorFusion q3],
                                       &roll,
                                       &pitch,
                                       &yaw);
    roll = NormalizeAngle(RadiansToDegrees(roll));
    pitch = NormalizeAngle(RadiansToDegrees(pitch));
    yaw = NormalizeAngle(RadiansToDegrees(yaw));
    
    // Test.
    XCTAssertTrue((NSInteger)(roll  * 100.0) == (NSInteger)([[samples lastObject][@"roll"] floatValue]  * 100.0));
    XCTAssertTrue((NSInteger)(pitch * 100.0) == (NSInteger)([[samples lastObject][@"pitch"] floatValue] * 100.0));
    XCTAssertTrue((NSInteger)(yaw   * 100.0) == (NSInteger)([[samples lastObject][@"yaw"] floatValue]   * 100.0));
}

@end
